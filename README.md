# Ansible Role: BIND

[![CI](https://github.com/lucab85/ansible-role-bind/workflows/CI/badge.svg?event=push)](https://github.com/lucab85/ansible-role-bind/actions?query=workflow%3ACI)

Installs and configures BIND server on Fedora/RHEL/CentOS or Debian/Ubuntu servers.

## Requirements

No special requirements; note that this role requires root access, so either run it in a playbook with a global `become: yes`, or invoke the role in your playbook like:

    - hosts: dns
      roles:
        - role: dns
          become: yes

## Role Variables

Available variables are listed along with default values in [defaults/main.yml](defaults/main.yml) file.


### Main configuration

All the settins in `bind_main_config_settings` are applied in the main configuration file `/etc/named.conf` for Fedora/CentOS/RHEL or `/etc/bind/named.conf` for Debian/Ubuntu (platform specific).
All the settings in `bind_main_options_settings` are applied in the main configuration file inside the `options { }` tag.
Example:

    bind_main_options_settings:
      - option: listen-on port
        value: '53 { 127.0.0.1; 10.0.1.1; };'
      - option: allow-query
        value: '{ trusted; };'
      - option: forwarders
        value: '{ 8.8.8.8; 8.8.4.4; };'
      - option: listen-on-v6
        value: '{ any; };'
      - option: dnssec-validation
        value: 'auto;'

Please note in these example **10.0.1.1** is the IPv4 of the target machine, adapt as you need.

    bind_main_config_settings:
      - option: acl "trusted"
        value: '{ 10.0.1.1; 10.0.1.2; };'

In these example I defined an acl **trusted** with two IPv4 addresses that we could use for our policy (see later), adapt as you need.

Example output:

    #
    # Ansible managed: Do NOT edit this file manually!
    #
    options {
        directory "/var/named";
        listen-on port 53 { 127.0.0.1; 10.0.1.1; };
        allow-query { trusted; };
        forwarders { 8.8.8.8; 8.8.4.4; };
        listen-on-v6 { any; };
        dnssec-validation auto;
    };
    acl "trusted" { 10.0.1.1; 10.0.1.2; };
    include "/etc/named/named.conf.local";


### Zone configuration

All the settings in `bind_zones_entries` are applied to zones definition template.
The settings are defined in the auxiliary configuration file `/etc/named/named.conf.local` for Fedora/CentOS/RHEL or `/etc/bind/named.conf.local` for Debian/Ubuntu (platform specific).
Example:

    bind_zones_entries:
      - {name: "example.com", type: "master", file: "example.com.zone", template: zone.fwd.j2}
      - {name: "1.0.10.in-addr.arpa", type: "master", file: "example.com.rr.zone", template: zone.rev.j2}

Example output:

    #
    # Ansible managed: Do NOT edit this file manually!
    #
    zone "example.com" IN {
        type master;
        file "example.com.zone";
        allow-update { none; };
    };
    zone "1.0.10.in-addr.arpa" IN {
        type master;
        file "example.com.rr.zone";
        allow-update { none; };
    };

Also creates the zone files `/var/named/example.com.zone` and `/var/named/example.com.rr.zone` for Fedora/CentOS/RHEL or `/var/lib/bind` for Debian/Ubuntu (platform specific)

Example output: `/var/named/example.com.zone`

    $ORIGIN example.com.
    $TTL 86400
    @         IN  SOA  dns1.example.com.  hostmaster.example.com. (
                  2001062501  ; serial
                  21600       ; refresh after 6 hours
                  3600        ; retry after 1 hour
                  604800      ; expire after 1 week
                  86400 )     ; minimum TTL of 1 day
    ;
    ;
              IN  NS     dns1.example.com.
              IN  NS     dns2.example.com.
    dns1      IN  A      10.0.1.1
              IN  AAAA   aaaa:bbbb::1
    dns2      IN  A      10.0.1.2
              IN  AAAA   aaaa:bbbb::2
    ;
    ;
    @         IN  MX     10  mail.example.com.
              IN  MX     20  mail2.example.com.
    mail      IN  A      10.0.1.5
              IN  AAAA   aaaa:bbbb::5
    mail2     IN  A      10.0.1.6
              IN  AAAA   aaaa:bbbb::6
    ;
    ;
    ; This sample zone file illustrates sharing the same IP addresses
    ; for multiple services:
    ;
    services  IN  A      10.0.1.10
              IN  AAAA   aaaa:bbbb::10
              IN  A      10.0.1.11
              IN  AAAA   aaaa:bbbb::11

    ftp       IN  CNAME  services.example.com.
    www       IN  CNAME  services.example.com.
    ;
    ;


Example output: `/var/named/example.com.rr.zone`

    $ORIGIN 1.0.10.in-addr.arpa.
    $TTL 86400
    @  IN  SOA  dns1.example.com.  hostmaster.example.com. (
           2001062501  ; serial
           21600       ; refresh after 6 hours
           3600        ; retry after 1 hour
           604800      ; expire after 1 week
           86400 )     ; minimum TTL of 1 day
    ;
    @  IN  NS   dns1.example.com.
    ;
    1  IN  PTR  dns1.example.com.
    2  IN  PTR  dns2.example.com.
    ;
    5  IN  PTR  server1.example.com.
    6  IN  PTR  server2.example.com.
    ;
    3  IN  PTR  ftp.example.com.
    4  IN  PTR  ftp.example.com.


## Dependencies

None.

## Example Playbook

    - hosts: dns
      become: yes
      vars_files:
        - vars/main.yml
      roles:
        - lucab85.ansible_role_bind

*Inside `vars/main.yml`*:

    bind_zones_entries:
    - {name: "example.com", type: "master", file: "example.com.zone", template: zone.fwd.j2}
    - {name: "1.0.10.in-addr.arpa", type: "master", file: "example.com.rr.zone", template: zone.rev.j2}

## License

MIT / BSD

## Author Information

This role was created in 2021 by [Luca Berton](https://www.lucaberton.it/).
